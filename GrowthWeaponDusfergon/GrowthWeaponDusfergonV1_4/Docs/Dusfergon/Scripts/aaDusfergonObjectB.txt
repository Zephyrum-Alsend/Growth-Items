scn aaDusfergonObjectB

;Related scripts
;-----------------------------------------------------------------------------
;aaDusfergonManager
;aaDusfergonOnBowHit
;aaDusfergonOnArrowHit
;-----------------------------------------------------------------------------

;Related globals
;-----------------------------------------------------------------------------
;aaDusfergonEquip
;aaDusfergonBroken
;-----------------------------------------------------------------------------

;Description
;-----------------------------------------------------------------------------
;Un/sets Equip flag and OnRelease event handler when un/equipping the bow.
;Removes all handlers and unsets Equip when removed from Player inventory.
;-----------------------------------------------------------------------------

;Parameters
;-----------------------------------------------------------------------------
float Health

ref Item
;-----------------------------------------------------------------------------



;-----------------------------------------------------------------------------
begin OnUnEquip Player
;-----------------------------------------------------------------------------

	Set aaDusfergonEquip to 0
	RemoveEventHandler "OnRelease" aaDusfergonOnBowHit

	;-----------------------------------------------------------------------------
	;Check if broken
	;-----------------------------------------------------------------------------
	foreach ( Item <- PlayerRef ) 

		if ( Item.GetBaseObject == DLScalar3 ) 

			Let Health := Item.GetCurrentHealth

			if ( Health <= 0 )

				Set aaDusfergonBroken to 1

			endif
			
			Break
			
		endif
		
	loop
	
;-----------------------------------------------------------------------------
end ;OnUnequip Player
;-----------------------------------------------------------------------------



;-----------------------------------------------------------------------------
begin OnEquip Player
;-----------------------------------------------------------------------------

	Set aaDusfergonEquip to 1
	SetEventHandler "OnRelease" aaDusfergonOnBowHit "ref"::Player

;-----------------------------------------------------------------------------
end ;OnEquip Player
;-----------------------------------------------------------------------------



;-----------------------------------------------------------------------------
begin OnDrop Player
;-----------------------------------------------------------------------------

	Set aaDusfergonEquip to 0
	RemoveEventHandler "OnHitWith" aaDusfergonOnHit
	RemoveEventHandler "OnRelease" aaDusfergonOnBowHit
	RemoveEventHandler "OnHitWith" aaDusfergonOnArrowHit

;-----------------------------------------------------------------------------
end ;OnDrop Player
;-----------------------------------------------------------------------------