scn aaDusfergonOnSigilStone

;Related scripts
;-----------------------------------------------------------------------------
;aaDusfergonManager
;aaDusfergonOnEnchant
;-----------------------------------------------------------------------------

;Related globals
;-----------------------------------------------------------------------------
;-----------------------------------------------------------------------------

;Description
;-----------------------------------------------------------------------------
;Undoes the last Sigil Stone enchantment if the passed item was used.
;-----------------------------------------------------------------------------

;Parameters
;-----------------------------------------------------------------------------
ref Sigil
ref Enchanted
ref Weap
;-----------------------------------------------------------------------------



;-----------------------------------------------------------------------------
begin Function { Weap }
;-----------------------------------------------------------------------------

	if ( GetLastSigilStoneEnchantedItem == Weap )

		RemoveEventHandler "OnHitWith" aaDusfergonOnHit
		RemoveEventHandler "OnRelease" aaDusfergonOnBowHit
		RemoveEventHandler "OnHitWith" aaDusfergonOnArrowHit
		Set aaDusfergonEquip to 0	

		MessageBoxEX "%n rejects the Sigil Stone used on it." Weap

		Set Sigil to GetLastUsedSigilStone
		Set Enchanted to GetLastSigilStoneCreatedItem

		Player.RemoveItemNS Enchanted 1
		Player.AddItemNS Weap 1
		Player.AddItem Sigil 1

	endif

	Return
;-----------------------------------------------------------------------------
end ;Function { Weap }
;-----------------------------------------------------------------------------