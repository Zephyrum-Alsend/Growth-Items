scn aaZefirosGetBroken

;Main script
;-----------------------------------------------------------------------------
;aaZefirosManager
;-----------------------------------------------------------------------------

;Used scripts
;-----------------------------------------------------------------------------
;-----------------------------------------------------------------------------

;Related scripts
;-----------------------------------------------------------------------------
;-----------------------------------------------------------------------------

;Used globals
;-----------------------------------------------------------------------------
;-----------------------------------------------------------------------------

;Related globals
;-----------------------------------------------------------------------------
;-----------------------------------------------------------------------------

;Description
;-----------------------------------------------------------------------------
;Given an Actor and an Object, returns the number of Object broken within
;Actor's inventory.
;-----------------------------------------------------------------------------

;Parameters
;-----------------------------------------------------------------------------
ref Object
ref Actor

short Broke ;Return value
short Count
short i
array_var Stack
ref Item
;-----------------------------------------------------------------------------

;-----------------------------------------------------------------------------
begin Function { Actor, Object }
;-----------------------------------------------------------------------------
	
	Let Broke := 0
	Let Stack := Actor.GetInvRefsForItem Object
	Let Count := ar_Size Stack

	if ( 0 < Count )

		Let i := 0
		while ( i < Count )

			Let Item := Stack[i]

			if ( Item.GetCurrentHealth <= 0 )

				Let Broke += Item.GetRefCount

			endif

			Let i += 1
		loop
		
	endif	


	SetFunctionValue Broke
	Return
;-----------------------------------------------------------------------------
end ;Function { Actor, Object }
;-----------------------------------------------------------------------------